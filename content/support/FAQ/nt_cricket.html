<HTML><HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1252"><META NAME="Generator" CONTENT="Microsoft Word 97/98"><TITLE>Cricket on NT: How To</TITLE><!--           #exec cmd="logger" --><STYLE TYPE="text/css"></STYLE></HEAD><BODY TEXT="#000000" LINK="#800000" VLINK="#008080" BGCOLOR="#ffffff"><TABLE CELLSPACING=0 BORDER=0 WIDTH=473><TR><TD VALIGN="MIDDLE" COLSPAN=3><P><U><FONT SIZE=5>Installing Cricket on NT 4.0</P></U></FONT><P>Revised 3/29/00</TD></TR><TR><TD VALIGN="MIDDLE" COLSPAN=3><P>Note: This document tells you how to take perfectly good software and scripts (Cricket by Jeff Allen), tweaking, editing, fiddling so it will run on Windows NT. I cannot guarantee that these steps will work for you, but it describes what worked for me. Jz.</TD></TR><TR><TD VALIGN="MIDDLE" COLSPAN=3 HEIGHT=120><P>(Along with this document, print or read the 'FAQ' and 'beginner.txt')</P><P>This all starts with Perl. You should be using Perl 5.004 or higher. Check it by running</P><FONT FACE="Courier New" SIZE=2><P>C:\&gt;perl -V</P></FONT><P>From the Command Prompt. The following is an example of mine:</P><FONT FACE="Courier New" SIZE=2><P>Characteristics of this binary (from libperl): </P><P>Locally applied patches: &#9;</P><P>ActivePerl Build 516 </P><P>Built under MSWin32 </P><P>Compiled at May 14 1999 19:54:31 </P><P>@INC: </P><P>C:/Perl/lib </P><P>C:/Perl/site/lib</P></FONT><P>Notice I'm using "ActivePerl" from "http://www.activestate.com/ActivePerl". "ActivePerl" is available under the GNU General Public License. For the sake of this document, I'll be referring to setting up Cricket for "ActivePerl".</P><B><P>Installing Modules for Perl</P></B><P>My Perl came with a "Perl Package Manager". By typing in "PPM" from the Command Prompt I could enter the package manager and "query" which modules were already installed with my copy of Perl. However it is that you install Perl modules for your copy of Perl, the following are the modules that you without a doubt need. Make no shortcuts here. Make sure all the following are installed and installed correctly.</P><B><P>Module</B>&#9;<B>From</B>&#9;</P><P>MD5&#9;&#9;CPAN: by-authors/id/GAAS/Digest-MD5-*.tar.gz&#9;</P><P>LWP&#9;&#9;CPAN: by-authors/id/GAAS/libwww-perl-*.tar.gz&#9;</P><P>DB_File&#9;&#9;CPAN: by-authors/id/PMQS/DB_File-*.tar.gz&#9;</P><P>Date::Parse&#9;CPAN: by-authors/id/GBARR/Timedate-*.tar.gz&#9;</P><P>Time::HiRes&#9;CPAN: by-authors/id/DEWEG/Time-HiRes-*.tar.gz&#9;</P><P>SNMP_Session&#9;http://www.switch.ch/misc/leinen/snmp/perl&#9;</P><P>RRD&#9;&#9;&#9;http://ee-staff.ethz.ch/~oetiker/webtools/rrdtool</P><P>&#9;</P><P>CPAN is the "Comprehensive Perl Archive Network". I did a web search for CPAN sites to download modules from. Check out the Perl FAQ at :</P><P><A HREF="ftp://ftp.cs.colorado.edu/pub/perl/CPAN/doc/FAQs/FAQ/PerlFAQ.html">ftp://ftp.cs.colorado.edu/pub/perl/CPAN/doc/FAQs/FAQ/PerlFAQ.html</A></P><B><P>Installing RRDTools Modules for Perl</P></B><P>Read Carefully!  Read you Perl documentation!</P><P>Change directory to where you have RRD Tools unzipped, untarred, whatever.</P><P>Change directory to the 'perl-shared' directory.  There should be a 'Makefile' in this directory as well as 'Makefile.PL'.  If not, you need to download a version of RRD Tools that has all these makefile goodies.  Run the 'Makefile.PL' script.  This uses the MakeMaker module to build a makefile or any extensions you might need.</P><P>    Perl Makefile.PL</P><P>Now run the 'make' utility, (if you don't have it, get it from ftp://ftp.microsoft.com/SoftLib/MSLfiles/nmake15.exe)</P><P>    Nmake</P><P>If the module has tests, it's a good idea to run them:</P><P>    Nmake test</P><P>If the test succeed, then run install</P><P>    Nmake install</P><P>By using PPM's "query" command you should see a list of all installed modules.&nbsp;</P><B><P>Extract Cricket to 'Your Working Directory'</P></B><P>Extract the Cricket 'tar.gz' files. The Cricket files should automatically be placed in 'C:\Cricket-X.XX'. (Where 'X.XX' is the version number. If not, put them there.) </P><I><P>Read 'beginner.txt'. Read the 'FAQ'.</P></I><P>Although much of 'beginner.txt' may not apply to NT installations it is still a good thing to read it. </P><P>Don't worry about 'choosing a user' to run cricket, (NT installations do that much later, if at all). </P><P>Don't worry about running 'configure' or making a 'softlink' on NT. The 'configure' script makes certain you have your main perl executable in the path. </P><B><P>Installing SNMP_Session</P></B><P>After downloading the SNMP_Session modules and extracting them to a sub-directory, copy the perl modules to your 'C:\cricket-0.72\lib' directory. (In this case, copying is 'OK').</P><P>&#9;BER.pm</P><P>&#9;SNMP_Session.pm</P><P>&#9;SNMP_util.pm</P><B><P>&nbsp;</P><P>Setting Cricket Up on NT</P></B><P>Edit the file 'subtree-sets' to describe exactly where your Cricket installation is. Since I installed Cricket to 'C:\cricket-0.72' my 'subtree-sets' looks like what follows:</P><FONT FACE="Courier New" SIZE=1><P># This file lists the subtrees that will be processed together in one</P><P># set. See the comments at the beginning of collect-subtrees for more info.</P><P># This will be passed to collector so it can find the Config Tree.</P><P># If this directory does not start with a slash, it will</P><P># have $HOME prepended.</P><B><P>base:&#9;/cricket-0.72/cricket-config</P></B><P># this is where logs will be put. (The $HOME rule applies here too.)</P><B><P>logdir:&#9;/cricket-0.72/cricket-logs</P></B><P>set normal:</P><P>&#9;/routers</P><P>&#9;/router-interfaces</P></FONT><P>I hardcoded the 'HOME' variable in the file 'c:\cricket-0.72\lib\common\options.pm'. I changed the line</P><FONT FACE="Courier New" SIZE=2><P>&#9;$ENV{'HOME'} = '' unless (defined($ENV{'HOME'})); </P></FONT><P>to</P><FONT FACE="Courier New" SIZE=2><P>&#9;$ENV{'HOME'} = '/cricket-0.72'; </P></FONT><P>Now make a cricket configuration as described in 'beginner.txt'.</P><P>Briefly, the 'sample-config' tree gets copied to 'cricket-config' and modified so that you're using only two of the subtrees, routers and router-interfaces, to start with. Here's an example of my 'Targets' file:</P><FONT FACE="Courier New" SIZE=2><P>target&#9;129.1.1.1</P><P>&#9;target-type=Cisco-2500-Router</P><P>&#9;short-desc&#9;=&#9;"Penton Routerman"</P><P>&#9;snmp-community&#9;=&#9;private</P><P>#target&#9;main-router</P><P>#&#9;target-type=Cisco-7500-Router</P><P>#&#9;short-desc&#9;= "Main router"</P></FONT><P>After making any changes to your 'cricket-config' you need to run 'compile'.</P><P>&nbsp;C:\&gt;perl compile</P><P>&nbsp;(Cricket should compile your router example)</P><P>&nbsp;C:\&gt;perl collector</P><P>&nbsp;(Cricket should create the RRD files in the newly formed 'C:\cricket-0.72\cricket-data').</P><P>&nbsp;What I saw on my screen looked like this:</P><P>&nbsp;C:\cricket-0.72&gt;perl cricket-compile</P><P>[13-Mar-2000 16:29:17 ] Starting compile: Cricket version 0.72 ( Sun Jan 23 23:54:35 PST 2000 )</P><P>[13-Mar-2000 16:29:17 ] Processed 3 nodes (in 3 files) in 1 seconds.</P><P>C:\cricket-0.72&gt;</P><P>&nbsp;Run collector with the 'debug' option to catch potential errors.</P><P>&nbsp;C:\cricket-0.72&gt;perl collector -loglevel debug</P><P>&nbsp;</P><P>Set up your 'router-interfaces' subtree as described in 'beginner.txt'. Briefly:</P><P>C:\cricket-0.72\util&gt;perl listinterfaces 128.1.4.220 public &gt; interfaces</P><P>Creates an 'interfaces' file you place in your 'router-interfaces' subtree. Whenever you change the 'config tree' remember to run 'compile' again. Run the 'collector' again to see if you're collecting data. If you're collecting data then congratulations! </P><B><P>Run 'collector' from 'cron'</P></B><P>In 'NT' speak 'cron' would mean 'NT Scheduler service'. Create a batch file and run it every five minutes.</P><FONT FACE="Courier" SIZE=2><P>@echo off</P><P>c:</P><P>cd\cricket-0.72</P><P>call c:\perl\bin\perl.exe c:\cricket-0.72\collector</P><P>exit</P></FONT><B><FONT SIZE=2><P>&nbsp;</P></FONT><P>Grapher.cgi</P></B><P>To run the grapher you need to have a working web-site on your NT server. </P><P>Since I'm using Microsoft IIS 4.0 my root directory for my web server is ' C:\InetPub\wwwroot'. I copied the following to my web server root-directory.</P><P>Grapher.cgi, Mini-graph.cgi, Version, C:\cricket-072\lib (cricket's lib directory), C:\cricket-0.72\images (cricket's images directory)</P><P>It's far better to make your cricket home directory a virtual directory on your web server.</P><P>Read 'PerlWin32Faq6.html' from ActiveState's 'ActivePerl'. It is ActivePerl's Win32 FAQ for Web Server Configuration. Microsoft IIS is not setup to use Perl CGI scripts by default. <B>YOU</B> have to configure IIS.</P><P>Edit 'grapher.cgi'. Change:</P><FONT FACE="Courier New" SIZE=2><P># If this variable does not start with /, $HOME will</P><P># be prepended. Special care is taken to set $HOME right,</P><P># even when running as user nobody (see fixHome for info).</P><P>$Common::global::gConfigRoot = '/cricket-config'; &#9;# i.e. $HOME/config</P></FONT><P>to. . .</P><FONT FACE="Courier New" SIZE=2><P># If this variable does not start with /, $HOME will</P><P># be prepended. Special care is taken to set $HOME right,</P><P># even when running as user nobody (see fixHome for info).</P><B><P>$Common::global::gConfigRoot = '/cricket-0.72/cricket-config'; </B>&#9;# i.e. $HOME/config</P></FONT><P>Edit 'mini-graph.cgi': Change:</P><FONT FACE="Courier New" SIZE=2><P>if (!defined($mtime) || ((time() - $mtime) &gt; $main::gPollingInterval)) {</P><P>&#9;# this request is actually going to need work... pass it on</P><P>&#9;exec("$gInstallRoot/grapher.cgi");</P><P>} else {</P><P>&#9;Debug("Cached image exists. Using that.");</P><P>&#9;sprayGif($imageName);</P><P>}</P></FONT><P>to</P><FONT FACE="Courier New" SIZE=2><P>if (!defined($mtime) || ((time() - $mtime) &gt; $main::gPollingInterval)) {</P><P>&#9;# this request is actually going to need work... pass it on</P><B><P>&#9;exec("perl $gInstallRoot/grapher.cgi");</P></B><P>} else {</P><P>&#9;Debug("Cached image exists. Using that.");</P><P>&#9;sprayGif($imageName);</P><P>}</P></FONT><P>Test your Cricket installation by using your web browser:</P><FONT FACE="MS Sans Serif,Times"><P>&#9;</FONT><A HREF="http://127.0.0.1/grapher.cgi">http://yourwebsite/grapher.cgi</A></P><P>Cricket working on NT. My thanks to Jeff Allen (<FONT FACE="MS Sans Serif,Times">Jeff Allen </FONT><U><FONT FACE="MS Sans Serif,Times" COLOR="#0000ff">jra@corp.webtv.net</U></FONT><FONT FACE="MS Sans Serif,Times">) </FONT>for Cricket and his 'beginner.txt' that helped shape this document. Thank You to Tobias Oetiker for his RRDTools! Any questions email me (John Zola jzola@penton.com).</TD></TR><TR><TD WIDTH="2%" VALIGN="MIDDLE" BGCOLOR="#ff0000"><P>&nbsp;</TD><TD WIDTH="96%" VALIGN="MIDDLE"><P>Questions or comments, email: <A HREF="mailto:jzola@penton.com">John Zola &lt;jzola@penton.com&gt;&nbsp;</A></TD><TD WIDTH="2%" VALIGN="MIDDLE" BGCOLOR="#ff0000"><P>&nbsp;</TD></TR></TABLE><P>&nbsp;</P><P><SPACER TYPE=VERTICAL SIZE=4></P></BODY></HTML>